<!DOCTYPE html>
<html>
<head>
    <title>{% if profile_edit %}Edit Profile{% else %}Edit Users{% endif %}</title>
</head>
<body>
    <h2>{% if profile_edit %}Edit Profile{% else %}Edit Users{% endif %}</h2>
    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% endif %}
    {% if messages %}
        {% for message in messages %}
            <p style="color: {% if message.tags == 'error' %}red{% else %}green{% endif %};">{{ message }}</p>
        {% endfor %}
    {% endif %}
    <form method="post">
        {% csrf_token %}
        {% if not profile_edit %}
        <input type="hidden" name="user_id" id="id_user_id" value="">
        {% endif %}
        <label for="id_username">Username:</label>
        <input type="text" name="username" id="id_username" value="{% if profile_edit %}{{ user.username }}{% endif %}" {% if not profile_edit %}required{% endif %}><br>
        <label for="id_first_name">First Name:</label>
        <input type="text" name="first_name" id="id_first_name" value="{% if profile_edit %}{{ user.first_name }}{% endif %}"><br>
        <label for="id_last_name">Last Name:</label>
        <input type="text" name="last_name" id="id_last_name" value="{% if profile_edit %}{{ user.last_name }}{% endif %}"><br>
        <label for="id_email">Email:</label>
        <input type="email" name="email" id="id_email" value="{% if profile_edit %}{{ user.email }}{% endif %}"><br>
        <label for="id_password">Password{% if profile_edit %} (leave blank to keep current){% endif %}:</label>
        <input type="password" name="password" id="id_password"><br>
        {% if not profile_edit %}
        <label for="id_role">Role:</label>
        <select name="role" id="id_role" required>
            <option value="admin">Admin</option>
            <option value="staff">Staff</option>
            <option value="user">User</option>
        </select><br>
        {% endif %}
        <button type="submit" id="submit_button">{% if profile_edit %}Update Profile{% else %}Create User{% endif %}</button>
    </form>
    {% if not profile_edit %}
    <h3>Existing Users</h3>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.first_name }}</td>
                <td>{{ user.last_name }}</td>
                <td>{{ user.email }}</td>
                <td>
                    <button onclick="editUser({{ user.id }}, '{{ user.username }}', '{{ user.first_name }}', '{{ user.last_name }}', '{{ user.email }}')">Edit</button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No users found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    <a href="{% url 'main_menu' %}">Back to Main Menu</a>
<script>
{% if not profile_edit %}
function editUser(userId, username, firstName, lastName, email) {
    document.getElementById('id_user_id').value = userId;
    document.getElementById('id_username').value = username;
    document.getElementById('id_first_name').value = firstName;
    document.getElementById('id_last_name').value = lastName;
    document.getElementById('id_email').value = email;
    document.getElementById('id_password').value = '';
    document.getElementById('submit_button').textContent = 'Update User';
}
{% endif %}
</script>
</body>
</html>
